# File Managed by Puppet

# site path: /var/www/wp.dev/
# wp path:   /var/www/wp.dev/core/
 
# site url: http://wp.dev/core/
# wp url:   http://wp.dev/core/
 
upstream php {
  server 127.0.0.1:9000;
}
 
server {
  listen <%= @port %>;
  server_name <%= @name %> <%= @serveraliases %>;
 
  root <%= @docroot %>;
 
  access_log  <%= scope.lookupvar('nginx::log_dir')%>/<%= @name %>.access.log;
  error_log  <%= scope.lookupvar('nginx::log_dir')%>/<%= @name %>.error.log;
 
  index index.html index.php;
 
  rewrite ^/wp/([_0-9a-zA-Z-]+)/(xmlrpc\.php|wp-[0-9a-z-]+\.php) /wp/$2;
  rewrite ^/wp/([_0-9a-zA-Z-]+)/(wp-(admin|content|includes).*) /wp/$2;
 
  location / {
    try_files $uri $uri/ /index.php;
  }
 
  location ~ \.php {
    include /etc/nginx/fastcgi_params;
    fastcgi_pass php;
  }

  location /phpmyadmin {
    root /usr/share/;
    index index.php index.html index.htm;
    location ~ ^/phpmyadmin/(.+\.php)$ {
      try_files $uri =404;
      root /usr/share/;
      fastcgi_pass 127.0.0.1:9000;
      fastcgi_index index.php;
      fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
      include /etc/nginx/fastcgi_params;
    }
    location ~* ^/phpmyadmin/(.+\.(jpg|jpeg|gif|css|png|js|ico|html|xml|txt))$ {
    root /usr/share/;
    }
  }
}
